"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function getChannelName(e){for(var t="";0!=e;)t=String.fromCharCode(e.mod(256))+t,e=e.div(256).floor();return t}function getContentTitle(e){var t=null;try{t=JSON.parse(e).title}catch(t){console.log("Invalid JSON: "+e)}return 0==t.replace(/ /g,"").length&&(t=null),t}function aggregateSignature(e,t){var n="0x"+t.args.contentID.toString(16);void 0===e.funds[n]&&e.sequence.unshift(n),e.funds[n]=t.args.newCred.toString()}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Post=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={newCred:"",title:"",body:"",publisher:"0x0",timestamp:"0",cred:0,rank:0,funds:0,signed:!1,signing:!1,error:""},n.signPost=n.signPost.bind(n),n.onCredChange=n.onCredChange.bind(n),n}return _inherits(t,e),_createClass(t,[{key:"componentDidMount",value:function(){var e=this,t=web3.toBigNumber(this.props.id);credsign.Post({contentID:t},{fromBlock:0,toBlock:"latest"}).get(function(n,a){credsign.Store({contentID:t},{fromBlock:0,toBlock:"latest"}).get(function(t,n){credrank.getCredRanksByContents(credsign.address,[e.props.id],function(t,o){var r=0;void 0!==window.accountSignatures&&(r=window.accountSignatures[e.props.account].funds[e.props.id]||0),e.setState({title:getContentTitle(n[0].args.attributes),body:JSON.parse(n[0].args.document).body,publisher:a[0].args.accountID,timestamp:a[0].args.timestamp,cred:o[0][0].toNumber(),rank:o[1][0].toNumber(),funds:r})})})})}},{key:"componentDidUpdate",value:function(){document.getElementById("post-"+this.props.id).innerHTML=marked(this.state.body)}},{key:"onCredChange",value:function(e){this.setState({newCred:e.target.value})}},{key:"signPost",value:function(){var e=this;this.setState({signing:!0});var t=this.state.newCred,n=parseInt(this.state.funds),a=t>n?web3.toBigNumber(10).pow(16).times(t-n):0;credsign.sign.estimateGas(this.props.id,t,credrank.address,{from:this.props.account,value:a},function(n,o){console.log(o),o+=1e5,credsign.sign(e.props.id,t,credrank.address,{from:e.props.account,value:a,gas:o},function(t,n){if(t)e.setState({error:t.toString()});else{var a=credsign.Sign({accountID:e.props.account,contentID:e.props.id},{fromBlock:"latest"});a.watch(function(t,n){a.stopWatching(),t?e.setState({error:t.toString()}):credrank.getCredRanksByContents(credsign.address,[e.props.id],function(t,a){e.setState({signing:!1,cred:a[0][0].toNumber(),rank:a[1][0].toNumber(),newCred:"",signed:!0,funds:n.args.newCred.toNumber()})})})}})})}},{key:"render",value:function(){var e=this.state.rank>0?"Rank "+this.state.rank+" with "+this.state.cred+"¢":"Currently unranked";return React.createElement("div",null,React.createElement("div",{style:{backgroundColor:"#FFF"}},React.createElement("div",{style:{maxWidth:"600px",margin:"0 auto"}},React.createElement("div",{style:{padding:"1.5em 1em"}},React.createElement("div",{style:{color:"gray",paddingBottom:"1em"}},React.createElement("span",null,"Posted "+new Date(1e3*this.state.timestamp).toLocaleString()+" by "),React.createElement("a",{href:"#/account/"+this.state.publisher,style:{borderBottom:"2px solid gray",padding:".5em 0",color:"gray"}},this.state.publisher.substr(0,5)+"..."+this.state.publisher.substr(-3)),React.createElement("span",null," in "),React.createElement("a",{href:"#/channel/"+this.props.channel,style:{color:"gray",borderBottom:"2px solid gray",paddingBottom:".5em"}},"#"+this.props.channel)),React.createElement("h1",null,this.state.title),React.createElement("div",{id:"post-"+this.props.id})))),React.createElement("div",{style:{maxWidth:"600px",margin:"0 auto"}},React.createElement("div",{className:"flex",style:{padding:"1.5em 1em"}},React.createElement("div",{className:"flex-grow",style:{display:"block",textAlign:"left"}},React.createElement("div",null,React.createElement("span",null,e))),React.createElement("div",{className:"flex-grow",style:{textAlign:"right",display:""==this.props.account?"none":"block"}},React.createElement("div",{style:{display:this.state.signing?"none":"block"}},React.createElement("input",{type:"text",name:"cred",placeholder:this.state.funds,value:this.state.newCred,onChange:this.onCredChange,style:{textAlign:"right",fontSize:"1em",border:"0",backgroundColor:"transparent",outline:"none"}}),React.createElement("span",{style:{paddingRight:".5em"}},"¢"),React.createElement("a",{onClick:this.signPost,style:{color:"black",display:"inline-block",borderBottom:"2px solid black",paddingBottom:".5em"}},"Sign")),React.createElement("div",{style:{display:this.state.signing?"block":"none"}},React.createElement("span",null,"Signing, please wait..."))))))}}]),t}(React.Component),Create=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={view:"edit",channel:"",error:""},n.preventHeaderUnbold=function(e){var t=e.target.getAttribute("data-action")||e.target.parentNode.getAttribute("data-action");if("bold"==t)for(var n=document.getElementsByClassName("medium-editor-button-active"),a=0;a<n.length;a++)if(/h+/.test(n[a].getAttribute("data-action","")))return e.stopPropagation(),void e.preventDefault()},n.preventFormatHotkey=function(e){if(e.ctrlKey||e.metaKey)switch(e.keyCode){case 66:case 98:case 73:case 105:case 85:case 117:return e.stopPropagation(),e.preventDefault(),!1}},n.editPost=n.editPost.bind(n),n.previewPost=n.previewPost.bind(n),n.setChannel=n.setChannel.bind(n),n.submitPost=n.submitPost.bind(n),n}return _inherits(t,e),_createClass(t,[{key:"componentDidMount",value:function(){new MediumEditor("#new-post-body",{buttonLabels:"fontawesome",keyboardCommands:!1,toolbar:{buttons:["bold","italic","h2","h3","image","anchor","pre","quote"]},placeholder:{text:"body",hideOnClick:!0}});document.addEventListener("click",this.preventHeaderUnbold,!0),document.addEventListener("keydown",this.preventFormatHotkey)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.preventHeaderUnbold),document.removeEventListener("keydown",this.preventFormatHotkey)}},{key:"editPost",value:function(){this.setState({view:"edit",error:""})}},{key:"previewPost",value:function(){this.setState({view:"preview",error:""}),document.getElementById("new-post-title-preview").innerHTML=document.getElementById("new-post-title").value,document.getElementById("new-post-body-preview").innerHTML=marked(toMarkdown(document.getElementById("new-post-body")))}},{key:"setChannel",value:function(e){this.setState({channel:e.target.innerHTML})}},{key:"submitPost",value:function(){var e=this;this.setState({view:"submit"}),credsign.getChannelByName(this.props.channel,function(t,n){var a=[],o=document.getElementById("new-post-title").value,r=toMarkdown(document.getElementById("new-post-body")),s=JSON.stringify({version:"1.0",title:o}),i=JSON.stringify({version:"1.0",body:r});if(0==n&&a.push("Channel must be between 3 and 30 characters and consist of only letters numbers and underscores"),(o.length<10||o>100)&&a.push("Title must be between 10 and 100 characters"),e.setState({error:a.join(". ")}),0==a.length){var l=web3.sha3(web3.toBigNumber(0).constructor.random().toString());e.setState({nonce:l}),credsign.post.estimateGas(e.props.channel,s,i,l,0,credrank.address,{from:e.props.account,value:0},function(t,n){console.log(n),n+=1e5,credsign.post(e.props.channel,s,i,l,0,credrank.address,{from:e.props.account,value:0,gas:n},function(t){if(t)e.setState({error:t.toString()});else{var n=credsign.Store({accountID:e.props.account,nonce:e.state.nonce},{fromBlock:"latest"});n.watch(function(t,a){n.stopWatching(),t?e.setState({error:t.toString()}):window.location.hash="#/channel/"+e.props.channel+"/post/0x"+a.args.contentID.toString(16)})}})})}})}},{key:"render",value:function(){var e=this;return React.createElement("div",{style:{width:"100%",margin:"0 auto"}},React.createElement("div",{style:{width:"100%",backgroundColor:"#FFF"}},React.createElement("div",{style:{maxWidth:"600px",margin:"0 auto"}},React.createElement("div",{style:{padding:"2em 1em"}},React.createElement("div",{style:{display:"edit"==this.state.view?"block":"none"}},React.createElement("textarea",{id:"new-post-title",type:"text",placeholder:"title"}),React.createElement("div",{id:"new-post-body",contentEditable:"true"})),React.createElement("div",{style:{display:"edit"!=this.state.view?"block":"none"}},React.createElement("h1",{id:"new-post-title-preview"}),React.createElement("div",{id:"new-post-body-preview"}))))),React.createElement("div",{style:{width:"100%"}},React.createElement("div",{style:{maxWidth:"600px",margin:"0 auto"}},React.createElement("div",{className:"flex",style:{padding:"1.5em 1em"}},React.createElement("div",{className:"flex-grow",style:{textAlign:"left"}},React.createElement("a",{style:{color:"black",display:"edit"==this.state.view?"inline-block":"none",borderBottom:"2px solid black",paddingBottom:".5em"},href:"#/channel/"+this.props.channel},"Cancel"),React.createElement("a",{style:{display:"edit"!=this.state.view?"inline-block":"none",borderBottom:"2px solid black",paddingBottom:".5em"},onClick:this.editPost},"Edit")),React.createElement("div",{className:"flex-grow",style:{textAlign:"right"}},React.createElement("a",{style:{display:"edit"==this.state.view?"inline-block":"none",borderBottom:"2px solid black",paddingBottom:".5em"},onClick:this.previewPost},"Preview"),React.createElement("a",{style:{display:"edit"!=this.state.view?"inline-block":"none",borderBottom:"2px solid black",paddingBottom:".5em"},onClick:this.submitPost},"Publish")),React.createElement("div",{className:"backdrop",style:{width:"100%",height:"100%",opacity:.5,backgroundColor:"black",position:"fixed",zIndex:1,display:"submit"==this.state.view?"block":"none",top:"0",left:"0"}}," "),React.createElement("div",{style:{display:"submit"==this.state.view?"block":"none",top:"25%",left:"0",width:"100%",position:"fixed",backgroundColor:"transparent",zIndex:2}},React.createElement("div",{style:{maxWidth:"600px",margin:"0 auto",backgroundColor:"#FCFCFC",border:"1px solid #DDD"}},React.createElement("div",{style:{padding:"1em",display:this.state.error.length>0?"block":"none"}},React.createElement("h1",null,"Unable to publish"),React.createElement("div",{style:{padding:"1em 0"}},this.state.error),React.createElement("span",{onClick:function(){return e.setState({view:"edit",error:""})},style:{borderBottom:"2px solid black",padding:".5em 0",display:"inline-block",cursor:"pointer"}},"Close")),React.createElement("div",{style:{padding:"1em",display:0==this.state.error.length?"block":"none"}},React.createElement("h1",null,"Publishing..."),React.createElement("div",{style:{padding:"1em 0"}},"Your post is being published. This page will redirect to your post once published. If you are not redirected after several minutes, try closing this message and publishing again."),React.createElement("span",{onClick:function(){return e.setState({view:"publish",error:""})},style:{borderBottom:"2px solid black",padding:".5em 0",display:"inline-block",cursor:"pointer"}},"Close"))))))))}}]),t}(React.Component),RankedChannels=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={loaded:!1,listItems:[],count:0},n}return _inherits(t,e),_createClass(t,[{key:"componentDidMount",value:function(){var e=this;credrank.getNumChannels(credsign.address,function(t,n){return 0==n?void e.setState({loaded:!0,listItems:[],count:0}):void credrank.getChannelsByRanks(credsign.address,1,n,function(t,a){for(var o=a[0],r=a[1].map(function(e){return e.toNumber()}),s=a[2].map(function(e){return e.toNumber()}),i=[],l=0;l<o.length;l++)i.push({id:"0x"+o[l].toString(16),channelName:getChannelName(o[l]),rank:s[l].toString(),cred:r[l].toString()});e.setState({loaded:!0,listItems:i,count:n})})})}},{key:"render",value:function(){var e=this.state.listItems.map(function(e){return React.createElement("li",{key:"li-"+e.id},React.createElement("a",{href:"#/channel/"+e.channelName},React.createElement("div",null,"#"+e.channelName),React.createElement("span",null,"Rank "+e.rank+" with "+e.cred+"¢ signed")))});return React.createElement("div",{className:"view-align"},React.createElement("div",null,React.createElement("span",null,"Top channels"),React.createElement("span",null," ("+this.state.count+")")),React.createElement("ol",null,e),React.createElement("span",{style:{paddingLeft:"1em",display:0==e.length?"block":"none",fontStyle:"italic"}},"Nothing to see here"))}}]),t}(React.Component),ChannelPosts=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={channelID:-1,listItems:[],filter:"Top",count:0},n.getPosts=n.getPosts.bind(n),n.getTopPosts=n.getTopPosts.bind(n),n.getNewPosts=n.getNewPosts.bind(n),n.onFilterChange=n.onFilterChange.bind(n),n}return _inherits(t,e),_createClass(t,[{key:"componentDidMount",value:function(){this.getPosts(this.state.filter,this.props.channel)}},{key:"componentWillReceiveProps",value:function(e){e.channel!=this.props.channel&&this.getPosts(this.state.filter,e.channel)}},{key:"onFilterChange",value:function(e){this.getPosts(e.target.innerHTML,this.props.channel)}},{key:"getPosts",value:function(e,t){this.setState({loading:!0,filter:e,menu:!1}),"Top"==e?this.getTopPosts(t):"New"==e&&this.getNewPosts(t)}},{key:"getTopPosts",value:function(e){var t=this;credsign.getChannelByName(e,function(e,n){credrank.getNumContents(credsign.address,n,function(e,a){return 0==a||0==n?void t.setState({loading:!1,listItems:[],channelID:n,count:0}):(t.setState({channelID:n,channelName:getChannelName(n)}),void credrank.getContentsByRanks(credsign.address,n,1,a,function(e,n){for(var o=[],r={},s=0;s<n[0].length;s++){var i="0x"+n[0][s].toString(16);r[i]=s,o.push({id:i,cred:n[1][s].toNumber(),rank:n[2][s].toNumber()})}credsign.Post({contentID:n[0]},{fromBlock:0,toBlock:"latest"}).get(function(e,n){n.forEach(function(e){var t=r["0x"+e.args.contentID.toString(16)];o[t].title=getContentTitle(e.args.attributes),o[t].timestamp=e.args.timestamp}),t.setState({listItems:o,count:a,loading:!1})})}))})})}},{key:"getNewPosts",value:function(e){var t=this;this.setState({loading:!0}),credsign.getChannelByName(e,function(e,n){credsign.getNumContents(n,function(e,a){if(a=a.toNumber(),0==a)return void t.setState({loading:!1,listItems:[],count:0});t.setState({channelID:n,channelName:getChannelName(n)});var o=Array.from(Array(2)).map(function(e,t){return t+1});credsign.ChannelSequence({channelID:n,sequenceNum:o},{fromBlock:0,toBlock:"latest"}).get(function(e,n){var o=n.map(function(e){return e.args.contentID}),r=[];credsign.Post({contentID:o},{fromBlock:0,toBlock:"latest"}).get(function(e,n){for(var s=0;s<n.length;s++)r.push({id:"0x"+o[s].toString(16),title:getContentTitle(n[s].args.attributes),timestamp:n[s].args.timestamp});credrank.getCredRanksByContents(credsign.address,o,function(e,o){for(var s=0;s<n.length;s++)r[s].cred=o[0][s].toNumber(),r[s].rank=o[1][s].toNumber();t.setState({loading:!1,listItems:r.reverse(),count:a})})})})})})}},{key:"render",value:function(){var e=this,t=this.state.listItems.map(function(t){var n="";return t.rank>0?(n="Rank "+t.rank+" with "+t.cred+"¢",t.signed&&(n+=t.funds>0?" - Signed with "+t.funds+"¢":" - Signed")):n="Unranked in #"+e.state.channelName,React.createElement("li",{key:"li-"+t.id},React.createElement("a",{href:"#/channel/"+e.props.channel+"/post/"+t.id},React.createElement("div",null,t.title),React.createElement("span",null,n)))});return React.createElement("div",{className:"view-align"},React.createElement("div",{style:{position:"relative",display:this.state.channelID>0?"block":"none"}},React.createElement("span",{onClick:function(){return e.setState({menu:!e.state.menu})},style:{cursor:"pointer"}},this.state.filter+" ▾"),React.createElement("ul",{onMouseLeave:function(){return e.setState({menu:!1})},style:{position:"absolute",top:"1.5em",left:"0",display:this.state.menu?"block":"none"}},React.createElement("li",{onClick:this.onFilterChange},"Top"),React.createElement("li",{onClick:this.onFilterChange},"New")),React.createElement("span",null," posts in #"+this.props.channel),React.createElement("span",null," ("+this.state.count+")")),React.createElement("div",{style:{display:0==this.state.channelID?"block":"none"}},"Invalid channel"),React.createElement("ol",null,t),React.createElement("span",{style:{paddingLeft:"1em",display:0==t.length?"block":"none",fontStyle:"italic"}},0!=this.state.channelID?this.state.loading?"Loading...":"Nothing to see here":"Channels must be between 3 and 30 characters consisting of letters, numbers, and underscores."))}}]),t}(React.Component),Account=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={filter:n.props.filter||"Posted",listItems:[],count:0},n.getPosts=n.getPosts.bind(n),n.getAddress=n.getAddress.bind(n),n.onFilterChange=n.onFilterChange.bind(n),n}return _inherits(t,e),_createClass(t,[{key:"getAddress",value:function(e){return parseInt(e)>0?e:"-1"}},{key:"componentDidMount",value:function(){var e=this.getAddress(this.props.account);this.getPosts(this.state.filter,e)}},{key:"componentWillReceiveProps",value:function(e){var t=this.getAddress(e.account);t!=this.props.account&&this.getPosts(this.state.filter,t)}},{key:"getPosts",value:function(e,t){var n=this;this.setState({loading:!0,menu:!1,filter:e});var a=[],o={sequence:[],funds:{}};"Posted"==e?credsign.Post({accountID:t},{fromBlock:0,toBlock:"latest"}).get(function(e,r){var s=[];r.forEach(function(e){s.push(e.args.contentID),a.push({id:"0x"+e.args.contentID.toString(16),title:getContentTitle(e.args.attributes),channelName:getChannelName(e.args.channelID),timestamp:e.args.timestamp})}),credsign.Sign({accountID:t},{fromBlock:0,toBlock:"latest"}).get(function(e,t){t.forEach(function(e){aggregateSignature(o,e)}),credrank.getCredRanksByContents(credsign.address,s,function(e,t){a.forEach(function(e,n){e.cred=t[0][n].toNumber(),e.rank=t[1][n].toNumber(),e.signed=void 0!==o.funds[e.id],e.funds=o.funds[e.id]||0}),n.setState({loading:!1,listItems:a.reverse()})})})}):"Funded"==e?credsign.Sign({accountID:t},{fromBlock:0,toBlock:"latest"}).get(function(e,t){t.forEach(function(e){aggregateSignature(o,e)});var r=o.sequence.filter(function(e){return o.funds[e]>0});credsign.Post({contentID:r},{fromBlock:0,toBlock:"latest"}).get(function(e,t){var s={};t.forEach(function(e,t){return s["0x"+e.args.contentID.toString(16)]=t}),credrank.getCredRanksByContents(credsign.address,r,function(e,i){r.forEach(function(e,n){var r=t[s[e]];a.push({id:e,title:getContentTitle(r.args.attributes),channelName:getChannelName(r.args.channelID),timestamp:r.args.timestamp,cred:i[0][n].toNumber(),rank:i[1][n].toNumber(),signed:!0,funds:o.funds[e]})}),n.setState({loading:!1,listItems:a})})})}):"Signed"==e&&credsign.Sign({accountID:t},{fromBlock:0,toBlock:"latest"}).get(function(e,t){t.forEach(function(e){aggregateSignature(o,e)}),credsign.Post({contentID:o.sequence},{fromBlock:0,toBlock:"latest"}).get(function(e,t){var r={};t.forEach(function(e,t){return r["0x"+e.args.contentID.toString(16)]=t}),credrank.getCredRanksByContents(credsign.address,o.sequence,function(e,s){o.sequence.forEach(function(e,n){var i=t[r[e]];a.push({id:e,title:getContentTitle(i.args.attributes),channelName:getChannelName(i.args.channelID),timestamp:i.args.timestamp,cred:s[0][n].toNumber(),rank:s[1][n].toNumber(),signed:!0,funds:o.funds[e]})}),n.setState({loading:!1,listItems:a})})})})}},{key:"onFilterChange",value:function(e){var t=e.target.innerHTML,n=this.getAddress(this.props.account);this.getPosts(t,n)}},{key:"render",value:function(){var e=this,t=this.state.listItems.map(function(e){var t="";return e.rank>0?(t="Rank "+e.rank+" in #"+e.channelName+" with "+e.cred+"¢",e.signed&&(t+=e.funds>0?" - Signed with "+e.funds+"¢":" - Signed")):t="Unranked in #"+e.channelName,React.createElement("li",{key:"li-"+e.id},React.createElement("a",{href:"#/channel/"+e.channelName+"/post/"+e.id},React.createElement("div",null,e.title),React.createElement("span",null,t)))});return React.createElement("div",{className:"view-align"},React.createElement("div",{style:{position:"relative"}},React.createElement("span",{onClick:function(){return e.setState({menu:!e.state.menu})},style:{cursor:"pointer"}},this.state.filter+" ▾"),React.createElement("ul",{onMouseLeave:function(){return e.setState({menu:!1})},onClick:this.onFilterChange,style:{position:"absolute",top:"1.5em",left:"0",display:this.state.menu?"block":"none"}},React.createElement("li",null,"Posted"),React.createElement("li",null,"Funded"),React.createElement("li",null,"Signed")),React.createElement("span",null," by account ("+t.length+")")),React.createElement("ol",null,t),React.createElement("span",{style:{paddingLeft:"1em",display:0==t.length?"block":"none",fontStyle:"italic"}},this.state.loading?"Loading...":"Nothing to see here"))}}]),t}(React.Component),Preview=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={title:"",body:"",publisher:"0x0",loading:!0,retries:10},n}return _inherits(t,e),_createClass(t,[{key:"componentDidMount",value:function(){var e=this,t=web3.toBigNumber(this.props.id);credsign.Store({contentID:t},{fromBlock:0,toBlock:"latest"}).get(function(t,n){t||0==n.length?(t&&console.log(t.toString()),e.state.retries>0&&(e.setState({retries:e.state.retries-1}),setTimeout(function(){e.componentDidMount()},500))):e.setState({title:getContentTitle(n[0].args.attributes),body:JSON.parse(n[0].args.document).body,publisher:n[0].args.accountID,channelName:getChannelName(n[0].args.channelID),loading:!1})})}},{key:"componentDidUpdate",value:function(){document.getElementById("post-"+this.props.id).innerHTML=marked(this.state.body)}},{key:"render",value:function(){return React.createElement("div",null,React.createElement("div",{style:{backgroundColor:"#FFF"}},React.createElement("div",{style:{maxWidth:"600px",margin:"0 auto"}},React.createElement("div",{style:{padding:"1.5em 1em",display:this.state.loading?"none":"block"}},React.createElement("div",{style:{color:"gray",paddingBottom:"1em"}},React.createElement("span",null,"Posted in #"+this.state.channelName)),React.createElement("h1",null,this.state.title),React.createElement("div",{id:"post-"+this.props.id})),React.createElement("div",{style:{padding:"1.5em 1em",display:this.state.loading?"block":"none"}},React.createElement("div",{style:{color:"gray",paddingBottom:"1em"}},React.createElement("span",{style:{display:0==this.state.retries?"block":"none"}},"Unable to fetch content"),React.createElement("span",{style:{display:0!=this.state.retries?"block":"none"}},"Loading..."))))))}}]),t}(React.Component),App=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={levelOne:"",levelTwo:"",levelThree:"",levelFour:"",account:"",mounted:!1,contentID:null},n.route=n.route.bind(n),n.setChannel=n.setChannel.bind(n),window.addEventListener("hashchange",function(){return n.route(window.location.hash)}),n}return _inherits(t,e),_createClass(t,[{key:"componentDidMount",value:function(){var e=this;this.route(window.location.hash),window.infura||web3.eth.getAccounts(function(t,n){if(n.length>0){var a=n[0];window.accountSignatures=_defineProperty({},a,{sequence:[],funds:{}});var o=credsign.Sign({accountID:a},{fromBlock:0,toBlock:"latest"});o.get(function(e,t){o.watch(function(e,t){aggregateSignature(accountSignatures[a],t)}),t.forEach(function(e){aggregateSignature(accountSignatures[a],e)})}),e.setState({account:a})}else e.setState({warn:!0})})}},{key:"setChannel",value:function(e){window.location.hash="#/"+this.state.levelOne+"/"+e.target.value,this.route(window.location.hash)}},{key:"componentDidUpdate",value:function(){document.getElementById("channel").innerHTML=this.state.levelTwo}},{key:"route",value:function(e){var t=e.split("/");t[1]=t.length>1?t[1]:"channel",t[2]=t.length>2?t[2]:"",t[3]=t.length>3?t[3]:"",t[4]=t.length>4?t[4]:"",this.setState({levelOne:t[1],levelTwo:t[2],levelThree:t[3],levelFour:t[4],mounted:!0})}},{key:"render",value:function(){var e=this,t="";return this.state.mounted&&(window.infura?"channel"==this.state.levelOne&&"post"==this.state.levelThree?t=React.createElement(Preview,{id:this.state.levelFour,channel:this.state.levelTwo}):window.location.replace("/?err=url"):"channel"==this.state.levelOne?t="post"==this.state.levelThree?React.createElement(Post,{id:this.state.levelFour,channel:this.state.levelTwo,account:this.state.account}):""==this.state.levelTwo?React.createElement(RankedChannels,null):React.createElement(ChannelPosts,{channel:this.state.levelTwo,account:this.state.account}):"publish"==this.state.levelOne?t=React.createElement(Create,{channel:this.state.levelTwo,account:this.state.account}):"account"==this.state.levelOne&&(t=React.createElement(Account,{account:this.state.levelTwo}))),React.createElement("div",{style:{padding:"3em 0"}},React.createElement("div",{style:{position:"fixed",width:"100%",backgroundColor:"#fafafa",borderBottom:"1px solid #DDD",color:"black",fontSize:"1.5em",top:0,fontWeight:"bold",padding:".5em 0",textAlign:"center",zIndex:10}},React.createElement("div",{style:{maxWidth:"600px",margin:"0 auto",display:window.infura?"none":"block"}},React.createElement("div",{className:"flex",style:{padding:"0 .66em"}},React.createElement("a",{href:"#/channel",className:"flex-grow",style:{color:"black",textAlign:"left",display:"inline-block"}},"Channels"),React.createElement("a",{href:"/terminal",alt:"¢"},React.createElement("img",{src:"logo.svg",style:{width:"1em",height:"1em",paddingTop:"2px"}})),React.createElement("a",{href:"#/account/"+this.state.account,className:"flex-grow",style:{color:"black",textAlign:"right",display:"inline-block"}},"Accounts"))),React.createElement("div",{style:{maxWidth:"600px",margin:"0 auto",display:window.infura?"block":"none"}},React.createElement("a",{href:"/",style:{padding:"0 .66em",display:"inline-block",color:"black",textDecoration:"none"}},"¢"))),React.createElement("div",{style:{maxWidth:"600px",margin:"0 auto",display:window.infura?"none":"block",padding:"1.5em 0"}},React.createElement("div",{className:"flex"},React.createElement("div",{className:"flex-grow"},React.createElement("div",{className:"flex",style:{padding:"0 1em",backgroundColor:"white",borderTop:"2px solid white",borderBottom:"2px solid white",borderRight:"0",borderLeft:"0"}},React.createElement("span",{className:"flex-shrink",style:{color:"gray",padding:".5em 0",fontWeight:"normal"}},"account"==this.state.levelOne?"@":"#"),React.createElement("input",{type:"text",placeholder:"account"==this.state.levelOne?"0x321...":"channel",id:"channel",className:"flex-grow",style:{backgroundColor:"transparent",fontSize:"1em",padding:".5em 0",margin:0,border:0,outline:0,placeholderTextColor:"gray",color:"black"},value:this.state.levelTwo,onChange:this.setChannel}))),React.createElement("div",{className:"flex-shrink"},React.createElement("a",{style:{margin:"0 1em",color:"black",display:"publish"==this.state.levelOne||""==this.state.account?"none":"block",borderBottom:"2px solid black",padding:".5em 0"},href:"#/publish/"+("channel"==this.state.levelOne?this.state.levelTwo:"")},"Publish")))),React.createElement("div",{style:{display:this.state.warn?"block":"none"}},React.createElement("div",{className:"backdrop",style:{width:"100%",height:"100%",opacity:.5,backgroundColor:"black",position:"fixed",zIndex:1,top:"0",left:"0"}}," "),React.createElement("div",{style:{top:"25%",left:"0",margin:"0 auto",width:"100%",zIndex:2,position:"fixed",backgroundColor:"transparent"}},React.createElement("div",{style:{maxWidth:"600px",margin:"0 auto",backgroundColor:"#FCFCFC",border:"1px solid #DDD"}},React.createElement("div",{style:{padding:"1em"}},React.createElement("h1",null,"Please link an account"),React.createElement("div",{style:{padding:"1em 0"}},"CredSign was unable to detect your Ethereum account. If you do not have an account, please install Mist or MetaMask and create one. You will need an account to publish and sign content."),React.createElement("span",{onClick:function(){return e.setState({warn:!1})},style:{borderBottom:"2px solid black",padding:".5em 0",display:"inline-block",cursor:"pointer"}},"Close"))))),React.createElement("div",null,t),React.createElement("div",{style:{width:"100%",position:"fixed",backgroundColor:"#fafafa",borderTop:"1px solid #DDD",color:"gray",bottom:0,fontSize:"69%",fontWeight:"bold",padding:"1em 0",textTransform:"uppercase",textAlign:"center",zIndex:10}},React.createElement("span",{className:"collapsable"},"Message us on "),React.createElement("a",{href:"https://facebook.com/CredSign",style:{padding:".5em 0",borderBottom:"2px solid gray",display:"inline-block",color:"gray"}},"Facebook"),React.createElement("span",null," · "),React.createElement("span",{className:"collapsable"},"View source on "),React.createElement("a",{href:"https://github.com/CredSign/credsign.github.io",style:{padding:".5em 0",borderBottom:"2px solid gray",display:"inline-block",color:"gray"}},"Github"),React.createElement("span",null," · "),React.createElement("span",{className:"collapsable"},"Usage governed by "),React.createElement("a",{href:"https://github.com/CredSign/credsign.github.io/blob/master/LICENSE",style:{color:"gray",padding:".5em 0",display:"inline-block",borderBottom:"2px solid gray"}},"terms")))}}]),t}(React.Component);window.App=App,window.toMarkdown=function(e){var t=function(e){return e?e.replace(/\s+/g," ").replace(/[\\\-*_>#]/g,"\\$&"):""},n=function(e,t){return new Array(t+1).join(e)},a=function(e,t){for(var n="",a=0,r=e.childNodes.length;a<r;a++)n+=o(e.childNodes[a],t);return n},o=function(e,o){var r="\n\n";if(3==e.nodeType)return t(e.nodeValue);if(1==e.nodeType){if("block"==o)switch(e.tagName.toLowerCase()){case"br":return r;case"hr":return r+"---"+r;case"p":case"div":case"section":case"address":case"center":return r+a(e,"block")+r;case"ul":return r+a(e,"u")+r;case"ol":return r+a(e,"o")+r;case"pre":return r+"    "+a(e,"inline")+r;case"code":if(1==e.childNodes.length)break;return r+"    "+a(e,"inline")+r;case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return r+n("#",+e.tagName[1])+"  "+a(e,"inline")+r;case"blockquote":return r+"> "+a(e,"inline")+r}if(/^[ou]+$/.test(o))return"LI"==e.tagName?"\n"+n("  ",o.length-1)+("o"==o[o.length-1]?"1. ":"- ")+a(e,o+"l"):(console.log("[toMarkdown] - invalid element at this point "+o.tagName),a(e,"inline"));if(/^[ou]+l$/.test(o)){if("UL"==e.tagName)return a(e,o.substr(0,o.length-1)+"u");if("OL"==e.tagName)return a(e,o.substr(0,o.length-1)+"o")}switch(e.tagName.toLowerCase()){case"strong":case"b":return"**"+a(e,"inline")+"**";case"em":
case"i":return"_"+a(e,"inline")+"_";case"code":return"`"+a(e,"inline")+"`";case"a":return"["+a(e,"inline")+"]("+e.getAttribute("href")+")";case"img":return r+"![: "+t(e.getAttribute("alt"))+"]("+e.getAttribute("src")+")"+r;case"script":case"style":case"meta":return"";default:return console.log("[toMarkdown] - undefined element "+e.tagName),a(e,o)}}};return o(e,"block").replace(/[\n]{2,}/g,"\n\n").replace(/^[\n]+/,"").replace(/[\n]+$/,"")};
//# sourceMappingURL=app.min.js.map
