<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CredSign</title>
    <link rel="apple-touch-icon" sizes="180x180" href="./app/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="./app/favicon/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="./app/favicon/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="./app/favicon/manifest.json">
    <link rel="mask-icon" href="./app/favicon/safari-pinned-tab.svg" color="#000000">
    <link rel="shortcut icon" href="./app/favicon/favicon.ico">
    <meta name="msapplication-config" content="./app/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Martel:400,700&amp;subset=latin-ext">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/medium-editor/5.21.1/css/medium-editor.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/medium-editor/5.21.1/css/themes/tim.css">
    <link rel="stylesheet" href="./app/default.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/humanize-duration/3.9.1/humanize-duration.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/medium-editor/5.21.1/js/medium-editor.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.6/marked.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.2/react.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.2/react-dom.min.js"></script>
    <script type="text/javascript" src="./app/dist/app.min.js"></script>
  </head>
  <body>
    <div id="main"></div>
    <script>
      window.addEventListener('load', function () {
        marked.setOptions({
          gfm: false,
          tables: false,
          breaks: false,
          pedantic: false,
          sanitize: true,
          smartLists: false
        });

        function getWeb3(done) {
          if (window.web3 === undefined) {
            (function(d, script) {
              script = d.createElement('script');
              script.type = 'text/javascript';
              script.async = true;
              script.onload = function () {
                if (window.location.protocol == 'https:') {
                  // Ordinary browser user on production site
                  window.web3 = new Web3(new Web3.providers.HttpProvider('https://morden.infura.io/rKXO8uv6njXPdnUsNSeE'));
                  window.infura = true;
                  done(2);
                }
                else {
                  // Local development
                  window.web3 = new Web3(new Web3.providers.HttpProvider('http://localhost:8545'));
                  window.web3.version.getNetwork(function (error, networkID) {
                    done(networkID);
                  });
                }
              };
              script.src = 'https://unpkg.com/web3@0.16.0/dist/web3.js';
              d.getElementsByTagName('head')[0].appendChild(script);
            }(document));
          }
          else {
            web3.version.getNetwork(function (error, networkID) {
              // MetaMisk/Mist user on mainnet - use infura testnet instead
              if (networkID == 1) {
                window.web3 = new Web3(new Web3.providers.HttpProvider('https://morden.infura.io/rKXO8uv6njXPdnUsNSeE'));
                window.infura = true;
              }
              done(2);
            });
          }
        }

        function getContracts(network, done) {
          (function(d, script) {
            script = d.createElement('script');
            script.type = 'text/javascript';
            script.async = true;
            script.onload = function() {
              window.indexer = web3.eth.contract(contracts.Indexer.interface).at(contracts.Indexer.address);
              window.publisher = web3.eth.contract(contracts.Publisher.interface).at(contracts.Publisher.address);
              done();
            };
            script.src = './networks/'+network+'/contracts.js';
            d.getElementsByTagName('head')[0].appendChild(script);
          }(document));
        }

        getWeb3(function (networkID) {
          var network = networkID == '2' ? 'testnet' : 'privnet';
          getContracts(network, function () {
            ReactDOM.render(React.createElement(window.App, null), document.getElementById('main'));
          });
        });
      });
    </script>
  </body>
</html>
